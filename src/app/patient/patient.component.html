<div class="odx-app-page">
  <odx-area-header size="large">
    Patient Information Query
  </odx-area-header>
  <div  odxLayout="grid" >
  <input type="text" [(ngModel)]="patientId" placeholder="Input PatientID" required>
  <button odxButton (click)="queryPatient(1)">Search Patient ID</button>
  <button odxButton (click)="exportToExcel()" [disabled]="!patientData() || patientData().length === 0">
    export Excel
  </button>
  <label for="pageSizeSelect"> Items per page: </label>
  <select id="pageSizeSelect" [(ngModel)]="pageSize" (change)="handlePageSizeChange()">
    <option [value]="5">5</option>
    <option [value]="10">10</option>
    <option [value]="20">20</option>
    <option [value]="50">50</option>
    <option [value]="100">100</option>
  </select>
  </div>
</div>

<div *ngIf="errorMessage" style="color: red;">
  Error: {{ errorMessage }}
</div>

<div>
  <table style="width: 100%" odxDataTable [variant]="variantValue" [dataSource]="dataSource()" [displayedColumns]="displayedColumns">

    <ng-container odxColumnDef="row_id">
      <th odxHeaderCell *odxHeaderCellDef>Row Index</th>
      <td odxCell *odxCellDef="let element">{{ element.row_id }}</td>
    </ng-container>

    <ng-container odxColumnDef="device_id">
      <th odxHeaderCell *odxHeaderCellDef>Monitor GUID</th>
      <td odxCell *odxCellDef="let element">{{ element.device_id }}</td>
    </ng-container>

    <ng-container odxColumnDef="local_time">
      <th odxHeaderCell *odxHeaderCellDef>Local Time</th>
      <td odxCell *odxCellDef="let element">{{ element.local_time }}</td>
    </ng-container>

    <ng-container odxColumnDef="Date">
      <th odxHeaderCell *odxHeaderCellDef>Date</th>
      <td odxCell *odxCellDef="let element">{{ element.Date }}</td>
    </ng-container>

    <ng-container odxColumnDef="Time">
      <th odxHeaderCell *odxHeaderCellDef>Time</th>
      <td odxCell *odxCellDef="let element">{{ element.Time }}</td>
    </ng-container>

    <ng-container odxColumnDef="Hour">
      <th odxHeaderCell *odxHeaderCellDef>Hour</th>
      <td odxCell *odxCellDef="let element">{{ element.Hour }}</td>
    </ng-container>

    <ng-container odxColumnDef="bed_label">
      <th odxHeaderCell *odxHeaderCellDef>Bed Label</th>
      <td odxCell *odxCellDef="let element">{{ element.bed_label }}</td>
    </ng-container>

    <ng-container odxColumnDef="pat_ID">
      <th odxHeaderCell *odxHeaderCellDef>Patient ID</th>
      <td odxCell *odxCellDef="let element">{{ element.pat_ID }}</td>
    </ng-container>

    <ng-container odxColumnDef="mon_unit">
      <th odxHeaderCell *odxHeaderCellDef>Monitoring Unit</th>
      <td odxCell *odxCellDef="let element">{{ element.mon_unit }}</td>
    </ng-container>

    <ng-container odxColumnDef="care_unit">
      <th odxHeaderCell *odxHeaderCellDef>Care Unit</th>
      <td odxCell *odxCellDef="let element">{{ element.care_unit }}</td>
    </ng-container>

    <ng-container odxColumnDef="alarm_grade">
      <th odxHeaderCell *odxHeaderCellDef>Alarm Grade</th>
      <td odxCell *odxCellDef="let element">{{ element.alarm_grade }}</td>
    </ng-container>

    <ng-container odxColumnDef="alarm_state">
      <th odxHeaderCell *odxHeaderCellDef>Alarm State</th>
      <td odxCell *odxCellDef="let element">{{ element.alarm_state }}</td>
    </ng-container>

    <ng-container odxColumnDef="Alarm Grade 2">
      <th odxHeaderCell *odxHeaderCellDef>Alarm Grade 2</th>
      <td odxCell *odxCellDef="let element">{{ element['Alarm Grade 2'] }}</td>
    </ng-container>

    <ng-container odxColumnDef="alarm_message">
      <th odxHeaderCell *odxHeaderCellDef>Alarm Message</th>
      <td odxCell *odxCellDef="let element">{{ element.alarm_message }}</td>
    </ng-container>

    <ng-container odxColumnDef="param_id">
      <th odxHeaderCell *odxHeaderCellDef>Param ID</th>
      <td odxCell *odxCellDef="let element">{{ element.param_id }}</td>
    </ng-container>

    <ng-container odxColumnDef="param_value">
      <th odxHeaderCell *odxHeaderCellDef>Param Value</th>
      <td odxCell *odxCellDef="let element">{{ element.param_value }}</td>
    </ng-container>

    <ng-container odxColumnDef="param_uom">
      <th odxHeaderCell *odxHeaderCellDef>Param UOM</th>
      <td odxCell *odxCellDef="let element">{{ element.param_uom }}</td>
    </ng-container>

    <ng-container odxColumnDef="param_upper_lim">
      <th odxHeaderCell *odxHeaderCellDef>Param Upper Limit</th>
      <td odxCell *odxCellDef="let element">{{ element.param_upper_lim }}</td>
    </ng-container>

    <ng-container odxColumnDef="param_lower_lim">
      <th odxHeaderCell *odxHeaderCellDef>Param Lower Limit</th>
      <td odxCell *odxCellDef="let element">{{ element.param_lower_lim }}</td>
    </ng-container>

    <ng-container odxColumnDef="Limit Violation Type">
      <th odxHeaderCell *odxHeaderCellDef>Limit Violation Type</th>
      <td odxCell *odxCellDef="let element">{{ element['Limit Violation Type'] }}</td>
    </ng-container>

    <ng-container odxColumnDef="Limit Violation Value">
      <th odxHeaderCell *odxHeaderCellDef>Limit Violation Value</th>
      <td odxCell *odxCellDef="let element">{{ element['Limit Violation Value'] }}</td>
    </ng-container>

    <ng-container odxColumnDef="onset_tick">
      <th odxHeaderCell *odxHeaderCellDef>Onset Tick</th>
      <td odxCell *odxCellDef="let element">{{ element.onset_tick }}</td>
    </ng-container>

    <ng-container odxColumnDef="alarm_duration">
      <th odxHeaderCell *odxHeaderCellDef>Alarm Duration</th>
      <td odxCell *odxCellDef="let element">{{ element.alarm_duration }}</td>
    </ng-container>

    <ng-container odxColumnDef="change_time(UTC)">
      <th odxHeaderCell *odxHeaderCellDef>Change Time (UTC)</th>
      <td odxCell *odxCellDef="let element">{{ element['change_time(UTC)'] }}</td>
    </ng-container>

    <ng-container odxColumnDef="change_tick">
      <th odxHeaderCell *odxHeaderCellDef>Change Tick</th>
      <td odxCell *odxCellDef="let element">{{ element.change_tick }}</td>
    </ng-container>

    <ng-container odxColumnDef="aborted">
      <th odxHeaderCell *odxHeaderCellDef>Aborted</th>
      <td odxCell *odxCellDef="let element">{{ element.aborted }}</td>
    </ng-container>

    <!-- 无数据的展示 -->
    <odx-table-empty>Not Found</odx-table-empty>

  </table>
</div>
<div >
  <odx-paginator
    [pageSize]="pageSize"
    [length]="totalItems"
    [pageIndex]="page - 1"
    (pageChanged)="onPageChange($event)"
  />
</div>

<!--&lt;!&ndash; 只有在有数据并且数组长度大于0时才显示表格 &ndash;&gt;
<table *ngIf="patientData?.length > 0" border="1">
  <thead>
  <tr>
    &lt;!&ndash; 表头 (同样假设数组中每个对象结构相同，以第一个对象获取keys为表头) &ndash;&gt;
    <th *ngFor="let key of getObjectKeys(patientData[0])">{{ key }}</th>
  </tr>
  </thead>
  <tbody>
  &lt;!&ndash; 遍历病人数组 &ndash;&gt;
  <tr *ngFor="let patient of patientData">
    <td *ngFor="let key of getObjectKeys(patient)">{{ patient[key] }}</td>
  </tr>
  </tbody>
</table>

&lt;!&ndash; 数据数组为空时显示提示 &ndash;&gt;
<div *ngIf="patientData && patientData.length === 0">
  <p>Not find patient</p>
</div>
&lt;!&ndash; 分页按钮 &ndash;&gt;
<div *ngIf="patientData && patientData.length > 0 && totalPages > 1">
  <button [disabled]="page <= 1" (click)="changePage(page - 1)">上一页</button>
  <span>第{{page}}页，共{{totalPages}}页，总共{{totalItems}}条数据</span>
  <button [disabled]="page >= totalPages" (click)="changePage(page + 1)">下一页</button>
</div>-->


